pcre_jit on;

events {
    worker_connections	1024;
}

http {
	upstream service1 {
		server service1:8199;
	}

	upstream controller {
		server controller:8197;
	}

	server {

		listen 8198;
		resolver 127.0.0.11 valid=20s;
		include mime.types;

		location / {
			auth_basic "Forbidden Access";
			auth_basic_user_file /etc/nginx/.htpasswd;
			root /usr/share/nginx/html;
			index index.html;
		}

		location /request {
			auth_basic "Forbidden Access";
			auth_basic_user_file /etc/nginx/.htpasswd;
			proxy_pass http://service1;
		}

		location /stop {
			auth_basic "Forbidden Access";
			auth_basic_user_file /etc/nginx/.htpasswd;
			proxy_pass http://controller;
		}
	}
}
